<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An image loading library designed for Compose Multiplatform and Android View. It is powerful and rich in functions. In addition to basic functions, it also supports GIF, SVG, video thumbnails, Exif Orientation, etc."><meta name=author content="2024 panpf"><link href=https://github.com/panpf/sketch/zh/getting_started/ rel=canonical><link href=../ rel=prev><link href=../register_component/ rel=next><link rel=icon href=../../images/logo.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Getting Started - Sketch Image Loader</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"JetBrains";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../ title="Sketch Image Loader" class="md-header__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sketch Image Loader </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Getting Started </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=white aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=black aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=../../getting_started/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=./ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../ title="Sketch Image Loader" class="md-nav__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> Sketch Image Loader </label> <div class=md-nav__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Getting Started </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 加载图片 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 支持的图片类型 </span> </a> </li> <li class=md-nav__item> <a href=#uri class=md-nav__link> <span class=md-ellipsis> 支持的 URI </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 平台差异 </span> </a> </li> <li class=md-nav__item> <a href=#sketch class=md-nav__link> <span class=md-ellipsis> Sketch </span> </a> <nav class=md-nav aria-label=Sketch> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 单例模式 </span> </a> </li> <li class=md-nav__item> <a href=#koin class=md-nav__link> <span class=md-ellipsis> Koin 模式 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imagerequest class=md-nav__link> <span class=md-ellipsis> ImageRequest </span> </a> <nav class=md-nav aria-label=ImageRequest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#imagerequest_1 class=md-nav__link> <span class=md-ellipsis> 创建 ImageRequest </span> </a> <nav class=md-nav aria-label="创建 ImageRequest"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#target class=md-nav__link> <span class=md-ellipsis> 配置 Target </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imagerequest_2 class=md-nav__link> <span class=md-ellipsis> 执行 ImageRequest </span> </a> <nav class=md-nav aria-label="执行 ImageRequest"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 获取结果 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 取消请求 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imageview class=md-nav__link> <span class=md-ellipsis> ImageView 扩展 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 文档 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../register_component/ class=md-nav__link> <span class=md-ellipsis> Register Component </span> </a> </li> <li class=md-nav__item> <a href=../compose/ class=md-nav__link> <span class=md-ellipsis> Compose </span> </a> </li> <li class=md-nav__item> <a href=../http/ class=md-nav__link> <span class=md-ellipsis> Http </span> </a> </li> <li class=md-nav__item> <a href=../animated_image/ class=md-nav__link> <span class=md-ellipsis> Animated Image </span> </a> </li> <li class=md-nav__item> <a href=../resize/ class=md-nav__link> <span class=md-ellipsis> Resize </span> </a> </li> <li class=md-nav__item> <a href=../transformation/ class=md-nav__link> <span class=md-ellipsis> Transformation </span> </a> </li> <li class=md-nav__item> <a href=../transition/ class=md-nav__link> <span class=md-ellipsis> Transition </span> </a> </li> <li class=md-nav__item> <a href=../state_image/ class=md-nav__link> <span class=md-ellipsis> StateImage </span> </a> </li> <li class=md-nav__item> <a href=../listener/ class=md-nav__link> <span class=md-ellipsis> Listener </span> </a> </li> <li class=md-nav__item> <a href=../download_cache/ class=md-nav__link> <span class=md-ellipsis> DownloadCache </span> </a> </li> <li class=md-nav__item> <a href=../result_cache/ class=md-nav__link> <span class=md-ellipsis> ResultCache </span> </a> </li> <li class=md-nav__item> <a href=../memory_cache/ class=md-nav__link> <span class=md-ellipsis> MemoryCache </span> </a> </li> <li class=md-nav__item> <a href=../fetcher/ class=md-nav__link> <span class=md-ellipsis> Fetcher </span> </a> </li> <li class=md-nav__item> <a href=../decoder/ class=md-nav__link> <span class=md-ellipsis> Decoder </span> </a> </li> <li class=md-nav__item> <a href=../target/ class=md-nav__link> <span class=md-ellipsis> Target </span> </a> </li> <li class=md-nav__item> <a href=../svg/ class=md-nav__link> <span class=md-ellipsis> SVG </span> </a> </li> <li class=md-nav__item> <a href=../video_frame/ class=md-nav__link> <span class=md-ellipsis> Video Frames </span> </a> </li> <li class=md-nav__item> <a href=../blurhash/ class=md-nav__link> <span class=md-ellipsis> BlurHash </span> </a> </li> <li class=md-nav__item> <a href=../exif_orientation/ class=md-nav__link> <span class=md-ellipsis> Exif Orientation </span> </a> </li> <li class=md-nav__item> <a href=../image_options/ class=md-nav__link> <span class=md-ellipsis> ImageOptions </span> </a> </li> <li class=md-nav__item> <a href=../request_interceptor/ class=md-nav__link> <span class=md-ellipsis> RequestInterceptor </span> </a> </li> <li class=md-nav__item> <a href=../decode_interceptor/ class=md-nav__link> <span class=md-ellipsis> DecodeInterceptor </span> </a> </li> <li class=md-nav__item> <a href=../preload/ class=md-nav__link> <span class=md-ellipsis> Preload </span> </a> </li> <li class=md-nav__item> <a href=../download_image/ class=md-nav__link> <span class=md-ellipsis> Download Image </span> </a> </li> <li class=md-nav__item> <a href=../lifecycle/ class=md-nav__link> <span class=md-ellipsis> Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=../sketch_image_view/ class=md-nav__link> <span class=md-ellipsis> SketchImageView </span> </a> </li> <li class=md-nav__item> <a href=../long_image_grid_thumbnails/ class=md-nav__link> <span class=md-ellipsis> Clearer Thumbnail </span> </a> </li> <li class=md-nav__item> <a href=../progress_indicator/ class=md-nav__link> <span class=md-ellipsis> Progress Indicator </span> </a> </li> <li class=md-nav__item> <a href=../mime_type_logo/ class=md-nav__link> <span class=md-ellipsis> Mime Type Logo </span> </a> </li> <li class=md-nav__item> <a href=../save_cellular_traffic/ class=md-nav__link> <span class=md-ellipsis> Save Cellular Data </span> </a> </li> <li class=md-nav__item> <a href=../pause_load_when_scrolling/ class=md-nav__link> <span class=md-ellipsis> Pause Load When Scrolling </span> </a> </li> <li class=md-nav__item> <a href=../apk_app_icon/ class=md-nav__link> <span class=md-ellipsis> Apk/App Icon </span> </a> </li> <li class=md-nav__item> <a href=../log/ class=md-nav__link> <span class=md-ellipsis> Log </span> </a> </li> <li class=md-nav__item> <a href=../migrate/ class=md-nav__link> <span class=md-ellipsis> Migrate </span> </a> </li> <li class=md-nav__item> <a href=../CHANGELOG/ class=md-nav__link> <span class=md-ellipsis> Change Log </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 加载图片 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 支持的图片类型 </span> </a> </li> <li class=md-nav__item> <a href=#uri class=md-nav__link> <span class=md-ellipsis> 支持的 URI </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 平台差异 </span> </a> </li> <li class=md-nav__item> <a href=#sketch class=md-nav__link> <span class=md-ellipsis> Sketch </span> </a> <nav class=md-nav aria-label=Sketch> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 单例模式 </span> </a> </li> <li class=md-nav__item> <a href=#koin class=md-nav__link> <span class=md-ellipsis> Koin 模式 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imagerequest class=md-nav__link> <span class=md-ellipsis> ImageRequest </span> </a> <nav class=md-nav aria-label=ImageRequest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#imagerequest_1 class=md-nav__link> <span class=md-ellipsis> 创建 ImageRequest </span> </a> <nav class=md-nav aria-label="创建 ImageRequest"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#target class=md-nav__link> <span class=md-ellipsis> 配置 Target </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imagerequest_2 class=md-nav__link> <span class=md-ellipsis> 执行 ImageRequest </span> </a> <nav class=md-nav aria-label="执行 ImageRequest"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 获取结果 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 取消请求 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imageview class=md-nav__link> <span class=md-ellipsis> ImageView 扩展 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 文档 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>开始使用<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <p>翻译：<a href=./ >English</a></p> <h2 id=_2>加载图片<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>用 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 加载图片非常简单，如下：</p> <p>Compose Multiplatform：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// val imageUri = &quot;/Users/my/Downloads/image.jpg&quot;</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1>// val imageUri = file:///compose_resource/composeResources/com.github.panpf.sketch.sample.resources/files/sample.png</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kd>val</span><span class=w> </span><span class=nv>imageUri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageUri</span><span class=p>,</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=p>)</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageUri</span><span class=p>,</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rememberAsyncImageState</span><span class=p>(</span><span class=n>ComposableImageOptions</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>        </span><span class=n>placeholder</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>        </span><span class=n>error</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>        </span><span class=n>crossfade</span><span class=p>()</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>        </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>    </span><span class=p>}),</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=p>)</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>    </span><span class=n>rqeuest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ComposableImageRequest</span><span class=p>(</span><span class=n>imageUri</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>        </span><span class=n>placeholder</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>        </span><span class=n>error</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>        </span><span class=n>crossfade</span><span class=p>()</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>        </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=p>)</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=n>Image</span><span class=p>(</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=w>    </span><span class=n>painter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rememberAsyncImagePainter</span><span class=p>(</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>        </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ComposableImageRequest</span><span class=p>(</span><span class=n>imageUri</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>            </span><span class=n>placeholder</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=w>            </span><span class=n>error</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>            </span><span class=n>crossfade</span><span class=p>()</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>            </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>    </span><span class=p>),</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=p>)</span>
</code></pre></div> <blockquote> <p>[!TIP] 1. 在 Compose Multiplatform 上你既可以直接使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 组件也可以使用 <code>Image + AsyncImagePainter</code> 来加载图片。 2. 但更推荐使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 组件，因为 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 会略快一些。 3. 这是由于 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 依赖组件的确切大小才会开始加载图片，<a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 在布局阶段就可以获取到组件的大小，而 <code>Image + AsyncImagePainter</code> 则是要等到绘制阶段才能获取到组件大小。 4. <code>placeholder(Res.drawable.placeholder)</code> 需要导入 <code>sketch-compose-resources</code> 模块</p> </blockquote> <p>Android View：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// val imageUri = &quot;/sdcard/download/image.jpg&quot;</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=c1>// val imageUri = &quot;file:///android_asset/image.jpg&quot;</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1>// val imageUri = &quot;content://media/external/images/media/88484&quot;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=kd>val</span><span class=w> </span><span class=nv>imageUri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>(</span><span class=n>imageUri</span><span class=p>)</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>(</span><span class=n>imageUri</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>placeholder</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=n>error</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=n>crossfade</span><span class=p>()</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=p>}</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>imageUri</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>    </span><span class=n>placeholder</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=n>error</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>    </span><span class=n>crossfade</span><span class=p>()</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=n>target</span><span class=p>(</span><span class=n>imageView</span><span class=p>)</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=p>}</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=n>context</span><span class=p>.</span><span class=na>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 会自动根据组件的大小来调整图片的尺寸，防止加载到内存的图片的尺寸超出组件自身的大小造成内存浪费，还会在组件销毁时自动取消请求</p> <h2 id=_3>支持的图片类型<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 支持多种类型的静态图片和动态图片，如下：</p> <table> <thead> <tr> <th style="text-align: left;">类型</th> <th>依赖模块</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">jpeg</td> <td>_</td> </tr> <tr> <td style="text-align: left;">png</td> <td>_</td> </tr> <tr> <td style="text-align: left;">bmp</td> <td>_</td> </tr> <tr> <td style="text-align: left;">webp</td> <td>_</td> </tr> <tr> <td style="text-align: left;">heif</td> <td>_</td> </tr> <tr> <td style="text-align: left;">avif</td> <td>_</td> </tr> <tr> <td style="text-align: left;">svg</td> <td>sketch-svg</td> </tr> <tr> <td style="text-align: left;">gif</td> <td>sketch-animated-gif<br>sketch-animated-gif-koral</td> </tr> <tr> <td style="text-align: left;">webp 动图</td> <td>sketch-animated-webp</td> </tr> <tr> <td style="text-align: left;">heif 动图</td> <td>sketch-animated-heif</td> </tr> <tr> <td style="text-align: left;">视频帧</td> <td>sketch-video<br>sketch-video-ffmpeg</td> </tr> <tr> <td style="text-align: left;">Apk 图标</td> <td>sketch-extensions-apkicon</td> </tr> </tbody> </table> <p>每一种图片类型都有对应的 Decoder 提供支持，<a href=../decoder/ >详细了解 Decoder</a></p> <h2 id=uri>支持的 URI<a class=headerlink href=#uri title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 支持从网络、本机、资源等不同的数据源加载图片，如下：</p> <table> <thead> <tr> <th style="text-align: left;">URI</th> <th style="text-align: left;">描述</th> <th style="text-align: left;">创建函数</th> <th style="text-align: left;">依赖模块</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">http://, https://</td> <td style="text-align: left;">File in network</td> <td style="text-align: left;">_</td> <td style="text-align: left;">sketch-http-hurl<br>sketch-http-okhttp<br>sketch-http-ktor2<br>sketch-http-ktor3</td> </tr> <tr> <td style="text-align: left;">file://, /, D:/</td> <td style="text-align: left;">File in SDCard</td> <td style="text-align: left;">newFileUri()</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">content://</td> <td style="text-align: left;">Android Content Resolver</td> <td style="text-align: left;">_</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">file:///android_asset/</td> <td style="text-align: left;">Android Asset</td> <td style="text-align: left;">newAssetUri()</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">android.resource://</td> <td style="text-align: left;">Android Resource</td> <td style="text-align: left;">newResourceUri()</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">data:image/, data:img/</td> <td style="text-align: left;">Base64</td> <td style="text-align: left;">newBase64Uri()</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">file:///compose_resource/</td> <td style="text-align: left;">Compose Resource</td> <td style="text-align: left;">newComposeResourceUri()</td> <td style="text-align: left;">sketch-compose-resources</td> </tr> <tr> <td style="text-align: left;">file:///kotlin_resource/</td> <td style="text-align: left;">Kotlin Resource</td> <td style="text-align: left;">newKotlinResourceUri()</td> <td style="text-align: left;">_</td> </tr> <tr> <td style="text-align: left;">blurhash://</td> <td style="text-align: left;">BlurHash</td> <td style="text-align: left;">newBlurHashUri()</td> <td style="text-align: left;">sketch-blurhash</td> </tr> <tr> <td style="text-align: left;">app.icon://</td> <td style="text-align: left;">Android App Icon</td> <td style="text-align: left;">newAppIconUri()</td> <td style="text-align: left;">sketch-extensions-appicon</td> </tr> </tbody> </table> <p>每一种 URI 都有对应的 Fetcher 对其提供支持，<a href=../fetcher/ >详细了解 Fetcher</a></p> <h2 id=_4>平台差异<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>由于受平台特性所限，在不同平台上的功能也有所不同，如下：</p> <table> <thead> <tr> <th style="text-align: left;">功能</th> <th>Android</th> <th style="text-align: left;">iOS</th> <th style="text-align: left;">Desktop</th> <th style="text-align: left;">Web</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">jpeg<br>png<br>webp<br>bmp</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">heif</td> <td>✅ (API 28)</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">avif</td> <td>✅ (API 31)</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">svg</td> <td>✅</td> <td style="text-align: left;">✅<br>(不支持 CSS)</td> <td style="text-align: left;">✅<br>(不支持 CSS)</td> <td style="text-align: left;">✅<br>(不支持 CSS)</td> </tr> <tr> <td style="text-align: left;">gif</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">webp 动图</td> <td>✅ (API 28)</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">heif 动图</td> <td>✅ (API 30)</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">视频帧</td> <td>✅</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">BlurHash</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">http://, https://<br>file://, /<br>file:///compose_resource/<br>data:image/, data:img/</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">file:///android_asset/<br>content://<br>android.resource://</td> <td>✅</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">file:///kotlin_resource/</td> <td>❌</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">Exif Orientation</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">内存缓存</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> </tr> <tr> <td style="text-align: left;">结果缓存</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">下载缓存</td> <td>✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">✅</td> <td style="text-align: left;">❌</td> </tr> <tr> <td style="text-align: left;">默认图片解码器</td> <td>BitmapFactory</td> <td style="text-align: left;">Skia Image</td> <td style="text-align: left;">Skia Image</td> <td style="text-align: left;">Skia Image</td> </tr> <tr> <td style="text-align: left;">最低 API</td> <td>API 21</td> <td style="text-align: left;">-</td> <td style="text-align: left;">JDK 1.8</td> <td style="text-align: left;">-</td> </tr> </tbody> </table> <blockquote> <p>最低 API 是 '-' 表示和 Compose Multiplatform 同步</p> </blockquote> <h2 id=sketch>Sketch<a class=headerlink href=#sketch title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 类是整个框架的核心，它用来执行并管理 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a></p> <p><code>sketch-compose-core</code> 和 <code>sketch-view-core</code> 模块提供了 ImageRequest, AsyncImage 等组件来加载图片，但他们还需要你创建 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 实例，然后在加载图片的时候使用它，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kd>val</span><span class=w> </span><span class=nv>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Sketch</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1>// Compose</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>     </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>,</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>     </span><span class=n>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>,</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>     </span><span class=n>moidifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Modifier</span><span class=p>.</span><span class=na>fillMaxSize</span><span class=p>(),</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>     </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span><span class=p>,</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=p>)</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1>// View</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>imageView</span><span class=p>,</span><span class=w> </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=n>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <p>为了更加便捷，Sketch 提供了单例模式和 Koin 模式，可以在加载图片的时候直接使用共享的 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 实例</p> <h3 id=_5>单例模式<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>你可以直接依赖 <code>sketch-compose</code> 或 <code>sketch-view</code> 模块使用单例模式，同时还提供了更加便捷的组件或加载函数，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>// Android</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kd>val</span><span class=w> </span><span class=nv>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>context</span><span class=p>.</span><span class=na>sketch</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=kd>val</span><span class=w> </span><span class=nv>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SingletonSketch</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1>// Non Android</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=kd>val</span><span class=w> </span><span class=nv>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SingletonSketch</span><span class=p>.</span><span class=na>get</span><span class=p>()</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=c1>// Compose</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>     </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>,</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>     </span><span class=n>moidifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Modifier</span><span class=p>.</span><span class=na>fillMaxSize</span><span class=p>(),</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>     </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span><span class=p>,</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=p>)</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=c1>// View</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>(</span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=c1>// or</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>imageView</span><span class=p>,</span><span class=w> </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>).</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <p>需要自定义 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 时可以通过以下方式创建 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 并配置它：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>// Android</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kd>class</span><span class=w> </span><span class=nc>MyApplication</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>Application</span><span class=p>(),</span><span class=w> </span><span class=n>SingletonSketch</span><span class=p>.</span><span class=na>Factory</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>createSketch</span><span class=p>():</span><span class=w> </span><span class=n>Sketch</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Sketch</span><span class=p>.</span><span class=na>Builder</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=na>apply</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>            </span><span class=n>logger</span><span class=p>(</span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Logger</span><span class=p>.</span><span class=na>Level</span><span class=p>.</span><span class=na>Debug</span><span class=p>)</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>            </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>        </span><span class=p>}.</span><span class=na>build</span><span class=p>()</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=p>}</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=c1>// Non Android. 在 App 入口函数中调用</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=n>SingletonSketch</span><span class=p>.</span><span class=na>setSafe</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>    </span><span class=n>Sketch</span><span class=p>.</span><span class=na>Builder</span><span class=p>(</span><span class=n>PlatformContext</span><span class=p>.</span><span class=na>INSTANCE</span><span class=p>).</span><span class=na>apply</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>        </span><span class=n>logger</span><span class=p>(</span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Logger</span><span class=p>.</span><span class=na>Level</span><span class=p>.</span><span class=na>Debug</span><span class=p>)</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>        </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>    </span><span class=p>}.</span><span class=na>build</span><span class=p>()</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=p>}</span>
</code></pre></div> <h3 id=koin>Koin 模式<a class=headerlink href=#koin title="Permanent link">&para;</a></h3> <p>如果你使用 Koin 作为依赖注入框架，就可以依赖 <code>sketch-compose-koin</code> 或 <code>sketch-view-koin</code> 模块使用 Koin 模式，同样也提供了更加便捷的组件或加载函数，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>// 在 App 的入口函数或 Application 的 onCreate 中初始化 koin</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>startKoin</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=n>modules</span><span class=p>(</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>         </span><span class=n>module</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>              </span><span class=n>single</span><span class=o>&lt;</span><span class=n>Sketch</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>                   </span><span class=n>Sketch</span><span class=p>.</span><span class=na>Builder</span><span class=p>(</span><span class=k>get</span><span class=p>()).</span><span class=na>apply</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>                        </span><span class=n>logger</span><span class=p>(</span><span class=n>level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Logger</span><span class=p>.</span><span class=na>Level</span><span class=p>.</span><span class=na>Debug</span><span class=p>)</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>                        </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>                   </span><span class=p>}.</span><span class=na>build</span><span class=p>()</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>              </span><span class=p>}</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>         </span><span class=p>})</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=p>}</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=c1>// 在任意位置获取实例</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=kd>val</span><span class=w> </span><span class=nv>sketch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KoinPlatform</span><span class=p>.</span><span class=na>getKoin</span><span class=p>().</span><span class=na>get</span><span class=o>&lt;</span><span class=n>Sketch</span><span class=o>&gt;</span><span class=p>()</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=c1>// Compose</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>     </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>,</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>     </span><span class=n>moidifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Modifier</span><span class=p>.</span><span class=na>fillMaxSize</span><span class=p>(),</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>     </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span><span class=p>,</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=p>)</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=c1>// View</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>(</span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=c1>// or</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>imageView</span><span class=p>,</span><span class=w> </span><span class=n>uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>).</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <h2 id=imagerequest>ImageRequest<a class=headerlink href=#imagerequest title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 用来描述一次图片加载请求，它包含图片的 uri 以及占位图、转换、过渡、新的尺寸、<a href=../target/ >Target</a> 、Listener 等配置</p> <h3 id=imagerequest_1>创建 ImageRequest<a class=headerlink href=#imagerequest_1 title="Permanent link">&para;</a></h3> <p>创建一个简单的 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a>，它限制图片的最大像素数为 300x300</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=n>size</span><span class=p>(</span><span class=m>300</span><span class=p>,</span><span class=w> </span><span class=m>300</span><span class=p>)</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=p>}</span>
</code></pre></div> <blockquote> <p>[!TIP] 关于 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 的更多配置请参考 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a>.Builder 类</p> </blockquote> <h4 id=target>配置 Target<a class=headerlink href=#target title="Permanent link">&para;</a></h4> <p>要想将结果直接加载到组件上还需要配置 <a href=../target/ >Target</a></p> <p>在 Compose 上 <a href=../target/ >Target</a> 由 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 和 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImagePainter.kt>AsyncImagePainter</a> 的基石 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImageState.kt>AsyncImageState</a> 来配置，你只需将 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 交给 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 或 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImagePainter.kt>AsyncImagePainter</a> 即可，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=n>size</span><span class=p>(</span><span class=m>300</span><span class=p>,</span><span class=w> </span><span class=m>300</span><span class=p>)</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=p>}</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>AsyncImage</span><span class=p>(</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>,</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=p>)</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=n>Image</span><span class=p>(</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>    </span><span class=n>painter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rememberAsyncImagePainter</span><span class=p>(</span><span class=n>request</span><span class=p>),</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span><span class=n>contentDescription</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;photo&quot;</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=p>)</span>
</code></pre></div> <blockquote> <p>[!CAUTION] 在 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 和 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImagePainter.kt>AsyncImagePainter</a> 中你不能调用 target() 函数，这会导致 App 崩溃</p> </blockquote> <p>在 Android View 系统中则需要你主动调用 target() 函数传入 ImageView，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=n>size</span><span class=p>(</span><span class=m>300</span><span class=p>,</span><span class=w> </span><span class=m>300</span><span class=p>)</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=n>target</span><span class=p>(</span><span class=n>imageView</span><span class=p>)</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>}</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=n>context</span><span class=p>.</span><span class=na>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</code></pre></div> <p>你还可以使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-view-core/src/main/kotlin/com/github/panpf/sketch/request/ImageRequest.view.kt>ImageRequest(ImageView, String)</a> 或 <a href=https://github.com/panpf/sketch/blob/main/sketch-view/src/main/kotlin/com/github/panpf/sketch/image_view_singleton_extensions.kt>ImageView.loadImage()</a> 扩展函数，它们会帮你调用 target()，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>imageView</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>    </span><span class=n>size</span><span class=p>(</span><span class=m>300</span><span class=p>,</span><span class=w> </span><span class=m>300</span><span class=p>)</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=p>}</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=n>context</span><span class=p>.</span><span class=na>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>    </span><span class=n>size</span><span class=p>(</span><span class=m>300</span><span class=p>,</span><span class=w> </span><span class=m>300</span><span class=p>)</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=c1>// There is a lot more...</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=p>}</span>
</code></pre></div> <h3 id=imagerequest_2>执行 ImageRequest<a class=headerlink href=#imagerequest_2 title="Permanent link">&para;</a></h3> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 创建好后要交由 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 去执行，<a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 支持异步和同步两种方式执行 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a>，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=c1>// 异步执行 ImageRequest 不阻塞当前线程，也不会挂起当前协程</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=kd>val</span><span class=w> </span><span class=nv>disposable</span><span class=p>:</span><span class=w> </span><span class=n>Disposable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=c1>// 同步执行 ImageRequest 挂起当前协程直到返回结果</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=n>coroutineScope</span><span class=p>.</span><span class=na>launch</span><span class=p>(</span><span class=n>Dispatchers</span><span class=p>.</span><span class=na>Main</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>image</span><span class=p>:</span><span class=w> </span><span class=n>Image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>image</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=p>}</span>
</code></pre></div> <blockquote> <p>[!NOTE] 单例模式为 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 提供了 <a href=https://github.com/panpf/sketch/blob/main/sketch-singleton/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.singleton.kt>ImageRequest</a>.enqueue() 和 <a href=https://github.com/panpf/sketch/blob/main/sketch-singleton/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.singleton.kt>ImageRequest</a>.execute() 扩展函数，方便顺序书写</p> </blockquote> <h4 id=_6>获取结果<a class=headerlink href=#_6 title="Permanent link">&para;</a></h4> <p>配置了 <a href=../target/ >Target</a> 时 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 会将结果交给 <a href=../target/ >Target</a> 去显示，但有时候需要通过结果做一些事情或者没有配置 <a href=../target/ >Target</a> 时就需要主动获取结果，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1>// 使用 enqueue() 方法异步执行请求时可以通过返回的 Disposable.job 获取结果</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=kd>val</span><span class=w> </span><span class=nv>disposable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=n>coroutineScope</span><span class=p>.</span><span class=na>launch</span><span class=p>(</span><span class=n>Dispatchers</span><span class=p>.</span><span class=na>Main</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>disposable</span><span class=p>.</span><span class=na>job</span><span class=p>.</span><span class=na>await</span><span class=p>()</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=p>}</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=c1>// 使用 execute() 方法同步执行请求时可以直接获取结果</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=n>coroutineScope</span><span class=p>.</span><span class=na>launch</span><span class=p>(</span><span class=n>Dispatchers</span><span class=p>.</span><span class=na>Main</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=p>}</span>
</code></pre></div> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageResult.kt>ImageResult</a> 包含了很多有用的信息，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>...</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=p>:</span><span class=w> </span><span class=n>ImageRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>request</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=kd>val</span><span class=w> </span><span class=nv>image</span><span class=p>:</span><span class=w> </span><span class=n>Image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>image</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=k>when</span><span class=w> </span><span class=p>(</span><span class=n>image</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=k>is</span><span class=w> </span><span class=n>BitmapImage</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>bitmap</span><span class=p>:</span><span class=w> </span><span class=n>Bitmap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=na>bitmap</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=k>is</span><span class=w> </span><span class=n>DrawableImage</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>drawable</span><span class=p>:</span><span class=w> </span><span class=n>Drawable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=na>drawable</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=k>is</span><span class=w> </span><span class=n>PainterImage</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>painter</span><span class=p>:</span><span class=w> </span><span class=n>Painter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=na>painter</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>    </span><span class=k>is</span><span class=w> </span><span class=n>AnimatedImage</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>codec</span><span class=p>:</span><span class=w> </span><span class=n>Codec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=na>codec</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=p>}</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>imageResult</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>ImageResult</span><span class=p>.</span><span class=na>Success</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>     </span><span class=kd>val</span><span class=w> </span><span class=nv>memoryCacheKey</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>memoryCacheKey</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>     </span><span class=kd>val</span><span class=w> </span><span class=nv>resultCacheKey</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>resultCacheKey</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>     </span><span class=kd>val</span><span class=w> </span><span class=nv>downloadCacheKey</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>downloadCacheKey</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>imageInfo</span><span class=p>:</span><span class=w> </span><span class=n>ImageInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>imageInfo</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>dataFrom</span><span class=p>:</span><span class=w> </span><span class=n>DataFrom</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>dataFrom</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>resize</span><span class=p>:</span><span class=w> </span><span class=n>Resize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>resize</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>transformeds</span><span class=p>:</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>transformeds</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>extras</span><span class=p>:</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=kt>String</span><span class=p>,</span><span class=w> </span><span class=kt>String</span><span class=o>&gt;?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>extras</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>imageResult</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>ImageResult</span><span class=p>.</span><span class=na>Error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>throwable</span><span class=p>:</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>imageResult</span><span class=p>.</span><span class=na>throwable</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=p>}</span>
</code></pre></div> <h4 id=_7>取消请求<a class=headerlink href=#_7 title="Permanent link">&para;</a></h4> <p>配置了 <a href=../target/ >Target</a> 时 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 会在下列情况下自动取消请求:</p> <ul> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImage.kt>AsyncImage</a> 或 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/AsyncImagePainter.kt>AsyncImagePainter</a> 组件被忘记</li> <li>ImageView 的 onViewDetachedFromWindow() 方法被执行</li> <li>Lifecycle 变为 DESTROYED 状态</li> </ul> <p>未配置 <a href=../target/ >Target</a> 或需要主动取消时可以通过 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/Disposable.kt>Disposable</a> 或 Job 来取消，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// 使用 enqueue() 方法异步执行请求时会返回一个 Disposable, 可以用来它在需要的时候取消请求</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=kd>val</span><span class=w> </span><span class=nv>disposable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>enqueue</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=n>disposable</span><span class=p>.</span><span class=na>dispose</span><span class=p>()</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=c1>// 使用 execute() 方法同步执行请求时可以通过其协程的 Job 在需要的时候取消请求</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=kd>val</span><span class=w> </span><span class=nv>job</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>coroutineScope</span><span class=p>.</span><span class=na>launch</span><span class=p>(</span><span class=n>Dispatchers</span><span class=p>.</span><span class=na>Main</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sketch</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=p>}</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=n>job</span><span class=p>.</span><span class=na>cancel</span><span class=p>()</span>
</code></pre></div> <h2 id=imageview>ImageView 扩展<a class=headerlink href=#imageview title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/Sketch.common.kt>Sketch</a> 为 ImageView 提供了一系列的扩展，如下:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1>// load</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>imageView</span><span class=p>.</span><span class=na>loadImage</span><span class=p>(</span><span class=s>&quot;https://www.example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=n>placeholder</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>    </span><span class=n>error</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>    </span><span class=n>crossfade</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=p>}</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=c1>// cancel</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=n>imageView</span><span class=p>.</span><span class=na>disposeLoad</span><span class=p>()</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=c1>// result</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=kd>val</span><span class=w> </span><span class=nv>imageResult</span><span class=p>:</span><span class=w> </span><span class=n>ImageResult? </span><span class=o>=</span><span class=w> </span><span class=n>imageView</span><span class=p>.</span><span class=na>imageResult</span>
</code></pre></div> <blockquote> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-view/src/main/kotlin/com/github/panpf/sketch/image_view_singleton_extensions.kt>loadImage()</a> 仅单例模式下可用</p> </blockquote> <h2 id=_8>文档<a class=headerlink href=#_8 title="Permanent link">&para;</a></h2> <p>基础功能：</p> <ul> <li><a href=../register_component/ >注册组件</a></li> <li><a href=../compose/ >Compose</a></li> <li><a href=../http/ >Http：加载网络图片</a></li> <li><a href=../animated_image/ >AnimatedImage：GIF、WEBP、HEIF</a></li> <li><a href=../resize/ >Resize：修改图片尺寸</a></li> <li><a href=../transformation/ >Transformation：转换图片</a></li> <li><a href=../transition/ >Transition：用炫酷的过渡方式显示图片</a></li> <li><a href=../state_image/ >StateImage：占位图和错误图</a></li> <li><a href=../listener/ >Listener：监听请求状态和下载进度</a></li> <li><a href=../download_cache/ >DownloadCache：了解下载缓存，避免重复下载</a></li> <li><a href=../result_cache/ >ResultCache：了解结果缓存，避免重复转换</a></li> <li><a href=../memory_cache/ >MemoryCache：了解内存缓存，避免重复加载</a></li> <li><a href=../fetcher/ >Fetcher：了解 Fetcher 及扩展新的 URI 类型</a></li> <li><a href=../decoder/ >Decoder：了解 Sketch 的解码过程</a></li> <li><a href=../target/ >Target：将加载结果应用到目标上</a></li> <li><a href=../svg/ >SVG：解码 SVG 静态图片</a></li> <li><a href=../video_frame/ >VideoFrames：解码视频帧</a></li> <li><a href=../blurhash/ >BlurHash</a></li> <li><a href=../exif_orientation/ >ExifOrientation：纠正图片方向</a></li> <li><a href=../image_options/ >ImageOptions：统一管理图片配置</a></li> <li><a href=../request_interceptor/ >RequestInterceptor：拦截 ImageRequest</a></li> <li><a href=../decode_interceptor/ >DecodeInterceptor：拦截解码过程</a></li> <li><a href=../preload/ >预加载图片到内存中</a></li> <li><a href=../download_image/ >下载图片</a></li> <li><a href=../lifecycle/ >Lifecycle</a></li> <li><a href=../log/ >日志</a></li> <li><a href=../migrate/ >迁移</a></li> </ul> <p>特色功能：</p> <ul> <li><a href=../sketch_image_view/ >SketchImageView：通过 XML 属性配置请求</a></li> <li><a href=../long_image_grid_thumbnails/ >提高长图在网格列表中的清晰度</a></li> <li><a href=../progress_indicator/ >显示下载进度</a></li> <li><a href=../mime_type_logo/ >显示图片类型角标</a></li> <li><a href=../save_cellular_traffic/ >蜂窝数据网络下暂停下载图片节省流量</a></li> <li><a href=../pause_load_when_scrolling/ >列表滑动中暂停加载图片</a></li> <li><a href=../apk_app_icon/ >显示 APK 文件或已安装 APP 的图标</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="上一页: Overview"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Overview </div> </div> </a> <a href=../register_component/ class="md-footer__link md-footer__link--next" aria-label="下一页: Register Component"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Register Component </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 panpf </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/panpf/sketch target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs", "content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.footer", "navigation.instant", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.50899def.min.js></script> </body> </html>