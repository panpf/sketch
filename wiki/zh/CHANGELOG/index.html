<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An image loading library designed for Compose Multiplatform and Android View. It is powerful and rich in functions. In addition to basic functions, it also supports GIF, SVG, video thumbnails, Exif Orientation, etc."><meta name=author content="2024 panpf"><link href=https://github.com/panpf/sketch/zh/CHANGELOG/ rel=canonical><link href=../migrate/ rel=prev><link rel=icon href=../../images/logo.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Change Log - Sketch Image Loader</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"JetBrains";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../ title="Sketch Image Loader" class="md-header__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sketch Image Loader </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Change Log </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=white aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=black aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=../../CHANGELOG/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=./ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../ title="Sketch Image Loader" class="md-nav__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> Sketch Image Loader </label> <div class=md-nav__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../getting_started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../register_component/ class=md-nav__link> <span class=md-ellipsis> Register Component </span> </a> </li> <li class=md-nav__item> <a href=../compose/ class=md-nav__link> <span class=md-ellipsis> Compose </span> </a> </li> <li class=md-nav__item> <a href=../http/ class=md-nav__link> <span class=md-ellipsis> Http </span> </a> </li> <li class=md-nav__item> <a href=../animated_image/ class=md-nav__link> <span class=md-ellipsis> Animated Image </span> </a> </li> <li class=md-nav__item> <a href=../resize/ class=md-nav__link> <span class=md-ellipsis> Resize </span> </a> </li> <li class=md-nav__item> <a href=../transformation/ class=md-nav__link> <span class=md-ellipsis> Transformation </span> </a> </li> <li class=md-nav__item> <a href=../transition/ class=md-nav__link> <span class=md-ellipsis> Transition </span> </a> </li> <li class=md-nav__item> <a href=../state_image/ class=md-nav__link> <span class=md-ellipsis> StateImage </span> </a> </li> <li class=md-nav__item> <a href=../listener/ class=md-nav__link> <span class=md-ellipsis> Listener </span> </a> </li> <li class=md-nav__item> <a href=../download_cache/ class=md-nav__link> <span class=md-ellipsis> DownloadCache </span> </a> </li> <li class=md-nav__item> <a href=../result_cache/ class=md-nav__link> <span class=md-ellipsis> ResultCache </span> </a> </li> <li class=md-nav__item> <a href=../memory_cache/ class=md-nav__link> <span class=md-ellipsis> MemoryCache </span> </a> </li> <li class=md-nav__item> <a href=../fetcher/ class=md-nav__link> <span class=md-ellipsis> Fetcher </span> </a> </li> <li class=md-nav__item> <a href=../decoder/ class=md-nav__link> <span class=md-ellipsis> Decoder </span> </a> </li> <li class=md-nav__item> <a href=../target/ class=md-nav__link> <span class=md-ellipsis> Target </span> </a> </li> <li class=md-nav__item> <a href=../svg/ class=md-nav__link> <span class=md-ellipsis> SVG </span> </a> </li> <li class=md-nav__item> <a href=../video_frame/ class=md-nav__link> <span class=md-ellipsis> Video Frames </span> </a> </li> <li class=md-nav__item> <a href=../blurhash/ class=md-nav__link> <span class=md-ellipsis> BlurHash </span> </a> </li> <li class=md-nav__item> <a href=../exif_orientation/ class=md-nav__link> <span class=md-ellipsis> Exif Orientation </span> </a> </li> <li class=md-nav__item> <a href=../image_options/ class=md-nav__link> <span class=md-ellipsis> ImageOptions </span> </a> </li> <li class=md-nav__item> <a href=../request_interceptor/ class=md-nav__link> <span class=md-ellipsis> RequestInterceptor </span> </a> </li> <li class=md-nav__item> <a href=../decode_interceptor/ class=md-nav__link> <span class=md-ellipsis> DecodeInterceptor </span> </a> </li> <li class=md-nav__item> <a href=../preload/ class=md-nav__link> <span class=md-ellipsis> Preload </span> </a> </li> <li class=md-nav__item> <a href=../download_image/ class=md-nav__link> <span class=md-ellipsis> Download Image </span> </a> </li> <li class=md-nav__item> <a href=../lifecycle/ class=md-nav__link> <span class=md-ellipsis> Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=../sketch_image_view/ class=md-nav__link> <span class=md-ellipsis> SketchImageView </span> </a> </li> <li class=md-nav__item> <a href=../long_image_grid_thumbnails/ class=md-nav__link> <span class=md-ellipsis> Clearer Thumbnail </span> </a> </li> <li class=md-nav__item> <a href=../progress_indicator/ class=md-nav__link> <span class=md-ellipsis> Progress Indicator </span> </a> </li> <li class=md-nav__item> <a href=../mime_type_logo/ class=md-nav__link> <span class=md-ellipsis> Mime Type Logo </span> </a> </li> <li class=md-nav__item> <a href=../save_cellular_traffic/ class=md-nav__link> <span class=md-ellipsis> Save Cellular Data </span> </a> </li> <li class=md-nav__item> <a href=../pause_load_when_scrolling/ class=md-nav__link> <span class=md-ellipsis> Pause Load When Scrolling </span> </a> </li> <li class=md-nav__item> <a href=../apk_app_icon/ class=md-nav__link> <span class=md-ellipsis> Apk/App Icon </span> </a> </li> <li class=md-nav__item> <a href=../log/ class=md-nav__link> <span class=md-ellipsis> Log </span> </a> </li> <li class=md-nav__item> <a href=../migrate/ class=md-nav__link> <span class=md-ellipsis> Migrate </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Change Log </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>更新日志<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <p>翻译：<a href=./ >English</a></p> <blockquote> <p>[!CAUTION] 1. 4.x 版本为兼容 Compose Multiplatform 而进行了大量破坏性重构和简化，不兼容 3.x 版本 2. maven groupId 升级为 <code>io.github.panpf.sketch4</code>，因此 2.*、3.* 版本不会提示升级 3. 参考 <a href=../migrate/ >《迁移文档》</a> 从 3.x 版本迁移 4.x 版本</p> </blockquote> <h1 id=440-alpha01>4.4.0-alpha01<a class=headerlink href=#440-alpha01 title="Permanent link">&para;</a></h1> <ul> <li>improve: DecodeConfig 现在可以从 common 模块访问</li> <li>new: 新增 'sketch-blurhash' 模块以支持 BlurHash，详情请参考文档 <a href=../blurhash/ >BlurHash</a>。<a href=https://github.com/panpf/sketch/issues/261>#261</a></li> </ul> <h1 id=431>4.3.1<a class=headerlink href=#431 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复从 4.3.0 版本开始 ThumbnailMemoryCacheStateImage 在遇到缓存 key 和 uri 相同或者尺寸相同的情况时返回 null 的 bug。<a href=https://github.com/panpf/sketch/issues/263>#263</a></li> </ul> <h1 id=430>4.3.0<a class=headerlink href=#430 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 ThumbnailMemoryCacheStateImage 在遇到没有 ImageInfo 的内存缓存时导致 App 崩溃或图片加载失败的 bug。 <a href=https://github.com/panpf/sketch/issues/259>#259</a></li> <li>fix: 修复 MemoryCacheRequestInterceptor 在遇到没有 ImageInfo 的缓存时图片加载失败的 bug。 <a href=https://github.com/panpf/sketch/issues/260>#260</a></li> <li>break: 'sketch-compose-koin', 'sketch-view-koin', 'sketch-koin' 模块的文件名从 Singleton 改为 Koin，二进制兼容性被破坏，依赖于此的库可能需要重新编译</li> <li>new: MemoryCache 新增 entries() 方法用于获取所有缓存条目</li> <li>improve: 改进 ThumbnailMemoryCacheStateImage 的性能，现在默认遍历所有的内存缓存并且改进缩略图的判断精度</li> </ul> <h1 id=420>4.2.0<a class=headerlink href=#420 title="Permanent link">&para;</a></h1> <blockquote> <p>[!NOTE] 和 4.2.0-beta02 版本相比没有任何改变`</p> </blockquote> <ul> <li>fix: 修复使用 sketch-http-ktor3 和 sketch-http-ktor2 时不更新下载进度的 bug。 <a href=https://github.com/panpf/sketch/issues/253>#253</a></li> <li>fix: 修复 AsyncImageState 因发起新请求而取消旧请求后，仍然可以收到旧请求的取消状态的 bug</li> <li>change: 弃用带有 keepContentNoneStartOnDraw 参数的 AsyncImage</li> <li>change: 弃用 TransitionTarget 的 fitScale 属性，新增 ViewTarget.scaleType 和 ComposeTarget.contentsScale 以及 ComposeTarget.alignment 代替 fitScale</li> <li>change: AnimatedImage 现在是接口，它的实现类是 SkiaAnimatedImage</li> <li>improve: 精简请求日志，去掉和加载无关的信息</li> <li>new: CrossfadePainter 现在支持 contentScale 和 alignment</li> <li>new: ResizePainter 现在支持 contentScale 和 alignment</li> <li>new: CrossfadeDrawable 现在支持 scaleType</li> <li>new: ResizeDrawable 现在支持 scaleType</li> <li>new: 新增 <code>sketch-compose-koin</code> 和 <code>sketch-view-koin</code> 模块，提供 Koin 依赖注入支持。 <a href=https://github.com/panpf/sketch/issues/256>#256</a></li> <li>new: 新增 <code>Sketch(PlatformContext, (Sketch.Builder.() -&gt; Unit)? = null)</code> 函数和 <code>Sketch.Builder.logger(Logger)</code> 函数</li> <li>new: ImageRequest、ImageOptions 和 ImageResult.Success 新增 downloadCacheKey, downloadCacheKeyMapper, resultCacheKey, resultCacheKeyMapper, memoryCacheKey, memoryCacheKeyMapper 属性。 <a href=https://github.com/panpf/sketch/issues/255>#255</a></li> </ul> <h1 id=420-beta02>4.2.0-beta02<a class=headerlink href=#420-beta02 title="Permanent link">&para;</a></h1> <ul> <li>new: 新增 <code>sketch-compose-koin</code> 和 <code>sketch-view-koin</code> 模块，提供 Koin 依赖注入支持。 <a href=https://github.com/panpf/sketch/issues/256>#256</a></li> <li>new: 新增 <code>Sketch(PlatformContext, (Sketch.Builder.() -&gt; Unit)? = null)</code> 函数和 <code>Sketch.Builder.logger(Logger)</code> 函数</li> <li>new: ImageRequest、ImageOptions 和 ImageResult.Success 新增 downloadCacheKey, downloadCacheKeyMapper, resultCacheKey, resultCacheKeyMapper, memoryCacheKey, memoryCacheKeyMapper 属性。 <a href=https://github.com/panpf/sketch/issues/255>#255</a></li> </ul> <h1 id=420-beta01>4.2.0-beta01<a class=headerlink href=#420-beta01 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复使用 sketch-http-ktor3 和 sketch-http-ktor2 时不更新下载进度的 bug。 <a href=https://github.com/panpf/sketch/issues/253>#253</a></li> <li>fix: 修复 AsyncImageState 因发起新请求而取消旧请求后，仍然可以收到旧请求的取消状态的 bug</li> <li>change: 弃用带有 keepContentNoneStartOnDraw 参数的 AsyncImage</li> <li>change: 弃用 TransitionTarget 的 fitScale 属性，新增 ViewTarget.scaleType 和 ComposeTarget.contentsScale 以及 ComposeTarget.alignment 代替 fitScale</li> <li>change: AnimatedImage 现在是接口，它的实现类是 SkiaAnimatedImage</li> <li>improve: 精简请求日志，去掉和加载无关的信息</li> <li>new: CrossfadePainter 现在支持 contentScale 和 alignment</li> <li>new: ResizePainter 现在支持 contentScale 和 alignment</li> <li>new: CrossfadeDrawable 现在支持 scaleType</li> <li>new: ResizeDrawable 现在支持 scaleType</li> </ul> <h1 id=410>4.1.0<a class=headerlink href=#410 title="Permanent link">&para;</a></h1> <blockquote> <p>[!CAUTION] compose multiplatform 1.8.0 版本必须 jvm 11 才能编译，请修改 sourceCompatibility、targetCompatibility、jvmTarget 等配置为 11+</p> </blockquote> <ul> <li>fix: 修复 CrossfadePainter, ResizePainter, ImageBitmapPainter 和 DrawablePainter 因丢失浮点精度导致内容无法充满画布的 bug</li> <li>new: AsyncImage 增加 keepContentNoneStartOnDraw 参数</li> <li>depend: 更新 kotlin 2.1.10</li> <li>depend: 更新 compose multiplatform 1.8.0</li> <li>depend: 更新 android-gif-drawable 1.2.29</li> <li>depend: 更新 ffmpegMediaMetadataRetriever 1.0.19</li> <li>depend: 更新 jetbrains-lifecycle 2.8.4</li> <li>depend: 更新 kotlinx-coroutines 1.10.2</li> <li>depend: 更新 ktor2 2.3.13</li> <li>depend: 更新 ktor3 3.0.3</li> <li>depend: 更新 okio 3.11.0</li> <li>depend: 不再替换 <code>kotlin-stdlib-jdk7</code> 和 <code>kotlin-stdlib-jdk8</code> 为 <code>kotlin-stdlib</code></li> </ul> <h1 id=406>4.0.6<a class=headerlink href=#406 title="Permanent link">&para;</a></h1> <p>compose:</p> <ul> <li>improve: 现在 AsyncImage 在窗口大小为 0 时不再崩溃，而是最小为 100。 <a href=https://github.com/panpf/sketch/issues/244>#244</a></li> </ul> <h1 id=405>4.0.5<a class=headerlink href=#405 title="Permanent link">&para;</a></h1> <p>fetch:</p> <ul> <li>fix: 修复 FileUriFetcher 无法加载 windows 文件路径的 bug。 <a href=https://github.com/panpf/sketch/issues/239>#239</a></li> </ul> <h1 id=404>4.0.4<a class=headerlink href=#404 title="Permanent link">&para;</a></h1> <p>compose:</p> <ul> <li>fix: 修复 AsyncImage 和 SubcomposeAsyncImage 在组件大小为 0 时无法加载图片的 bug。 <a href=https://github.com/panpf/sketch/issues/236>#236</a></li> <li>improve: 恢复 AsyncImage 和 SubcomposeAsyncImage 在设置 size 时如果宽或高为 0 就替换为窗口容器大小的功能</li> </ul> <h1 id=403>4.0.3<a class=headerlink href=#403 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 svg 文件头部有注释时 SvgDecoder 无法识别的 bug。 <a href=https://github.com/panpf/sketch/issues/232>#232</a></li> </ul> <h1 id=402>4.0.2<a class=headerlink href=#402 title="Permanent link">&para;</a></h1> <p>compose:</p> <ul> <li>fix: 当前窗口大小改变时 AsyncImage 组件会重新加载。 <a href=https://github.com/panpf/sketch/issues/231>#231</a></li> </ul> <h1 id=401>4.0.1<a class=headerlink href=#401 title="Permanent link">&para;</a></h1> <p>android:</p> <ul> <li>fix: 修复 BitmapImage 转为 BitmapDrawable 时没有设置 Resources 导致 BitmapDrawable 的 Intrinsic 尺寸和 Bitmap 不一致的 bug。 <a href=https://github.com/panpf/sketch/issues/226>#226</a></li> </ul> <h1 id=400-stable>4.0.0 Stable<a class=headerlink href=#400-stable title="Permanent link">&para;</a></h1> <p>Sketch:</p> <ul> <li>change: SketchSingleton 重构为 SingletonSketch</li> <li>change: Sketch 的 execute(DownloadRequest) 和 enqueue(DownloadRequest) 方法重构为 executeDownload( ImageRequest) 和 enqueueDownload(ImageRequest)</li> <li>new: Sketch.Builder 和 ComponentRegistry.Builder 新增 addComponents() 函数</li> <li>new: Sketch.Builder 增加 networkParallelismLimited() 和 decodeParallelismLimited() 方法控制网络和解码并发数量 <a href=https://github.com/panpf/sketch/issues/200>#200</a></li> <li>new: 新增 ComponentLoader，支持自动探测并注册 Fetcher 和 Decoder 组件，所有自带模块里的组件都已支持</li> </ul> <p>request:</p> <ul> <li>change: 不再区分 Display、Load、Download，现在只有一个 ImageRequest、ImageResult、ImageListener</li> <li>change: ImageResult 的 requestKey 属性被移除、requestCacheKey 属性重命名为 cacheKey</li> <li>change: 现在 Target、ImageResult、DecodeResult 都使用 Image</li> <li>change: SketchDrawable 的 imageUri、requestKey、requestCacheKey、imageInfo、dataFrom、transformedList、extras 等属性被移除，现在请从 ImageResult 中获取它们</li> <li>change: depth 和 depthFrom 属性合并成 DepthHolder</li> <li>change: bitmapConfig、colorSpace、preferQualityOverSpeed、placeholder(Int)、fallback(Int)、error(Int) 等 Android 平台特有 API 以扩展函数的形式提供</li> <li>change: resizeApplyToDrawable 重命名为 resizeOnDraw</li> <li>change: Parameters 重命名为 Extras</li> <li>change: LongImageClipPrecisionDecider 重命名为 LongImagePrecisionDecider, LongImageStartCropScaleDecider 重命名为 LongImageScaleDecider</li> <li>remove: 移除 listener() 和 progressListener() 方法，现在请使用 addListener() 和 addProgressListener() 方法</li> <li>new: 新增 'sizeMultiplier: Float' 属性，用于设置图片大小的缩放比例</li> <li>new: 新增 'allowNullImage: Boolean' 属性</li> </ul> <p>fetch:</p> <ul> <li>change: Fetcher.Factory.create() 的传参改为 RequestContext</li> <li>new: ResourceUriFetcher 支持 'android.resource:///drawable/ic_launcher' 和 'android.resource: ///1031232' uri</li> <li>new: AssetUriFetcher 支持 'file:///android_asset/' uri</li> </ul> <p>source:</p> <ul> <li>change: 重构 DataSource</li> </ul> <p>decode:</p> <ul> <li>change: Decoder 的 decode() 方法移除 suspend 修饰符并且返回类型从 Result<decoderesult> 改为 DecodeResult</li> <li>change: BitmapDecoder 和 DrawableDecoder 合并为 Decoder</li> <li>change: BitmapDecodeInterceptor 和 DrawableDecodeInterceptor 合并为 DecodeInterceptor</li> <li>change: BitmapConfig 重构为 BitmapColorType</li> <li>improve: 改进动图相关 Decoder 在判断图片类型时的准确性，不再依赖 FetchResult 的 mimeType 属性，因为它可能不准确</li> <li>new: DrawableDecoder 支持 colorSpace</li> </ul> <p>transformation:</p> <ul> <li>fix: 修复 CircleCrop、Rotate、RoundedCorners Transformation 在 RGB_565 时不工作的 bug。 <a href=https://github.com/panpf/sketch/issues/209>#209</a></li> <li>fix: 修复 Android 平台上 blur、rotate 等 Transformation 没有保持 ColorSpace 不变的 bug。 <a href=https://github.com/panpf/sketch/issues/213>#213</a></li> <li>change: Transformation 的 transform() 方法移除 suspend 修饰符</li> </ul> <p>cache:</p> <ul> <li>remove: 移除 BitmapPool 以及和它相关的 disallowReuseBitmap 属性、CountBitmap、SketchCountBitmapDrawable 类</li> <li>change: 重构 DiskCache SnapShot 和 Editor，get() 和 edit() 改为 openSnapShot() 和 openEditor() ，并且同一个 key 的 openSnapShot() 和 openEditor() 现在是互相冲突的, openSnapshot 未关闭前 openEditor 始终返回 null</li> <li>change: 重构 MemoryCache.Value</li> </ul> <p>state:</p> <ul> <li>change: ImageRequest 和 ImageOptions 的 uriEmpty 属性重命名为 fallback</li> <li>change: ImageRequest 和 ImageOptions 的 error 属性的类型从 ErrorStateImage 改为 StateImage</li> <li>change: ErrorStateImage 移除 ErrorStateImage.Builder.uriEmptyError() 方法并重构为 ConditionStateImage</li> <li>improve: 改进 IconDrawable，支持有固定大小的 background 并且限制 icon 必须有固定尺寸或指定 iconSize</li> </ul> <p>animated:</p> <ul> <li>fix: 修复 GifDrawable 和 MovieDrawable 无法正确应用 animatedTransformation 的 bug。 <a href=https://github.com/panpf/sketch/issues/214>#214</a></li> <li>fix: 修复 GifDrawableDecoder 的 repeatCount 设置错误应该加 1 的 bug。 <a href=https://github.com/panpf/sketch/issues/215>#215</a></li> <li>change: 拆分 sketch-animated 模块为 sketch-animated-core 和 sketch-animated-gif、sketch-animated-webp、sketch-animated-heif, sketch-animated-koralgif 模块重命名为 sketch-animated-gif-koral</li> </ul> <p>http:</p> <ul> <li>remove: 移除 DisplayRequest.Builder 和 DisplayOptions.Builder 的 setHttpHeader() 和 addHttpHeader() 方法</li> <li>change: http 功能拆分成单独的模块提供，增加 sketch-http、sketch-http-hurl、sketch-http-ktor2、sketch-http-ktor3 模块，sketch-okhttp 模块重命名为 sketch-http-okhttp</li> </ul> <p>compose:</p> <ul> <li>fix: 修复 AsyncImage 的 filterQuality 参数无效的 bug。 <a href=https://github.com/panpf/sketch/issues/211>#211</a></li> <li>remove: AsyncImage 可组合函数移除 placeholder、error、uriEmpty、onLoading、onSuccess、onError 参数</li> <li>new: AsyncImageState 现在可以设置 ImageOptions 了，例如：'rememberAsyncImageState { ImageOptions() }'</li> <li>new: 新增 ErrorStateImage.Builder.saveCellularTrafficError(DrawableResource) 扩展函数</li> <li>new: ImageRequest.Builder 和 ImageOptions.Builder 新增 size(IntSize) 扩展函数</li> <li>new: AsyncImageState 新增 onPainterState 和 onLoadState 属性，用于以回调的方式接收 PainterState 和 LoadState 更新</li> <li>new: 新增 ComposableImageRequest() 和 ComposableImageOptions() 函数，可以直接在 placeholder、error、fallback 方法上使用使用 DrawableResource</li> </ul> <p>view:</p> <ul> <li>fix: 修复当 ImageView 已附到窗口但是因 padding 导致 size 为 null 时无法加载图片的 bug。 <a href=https://github.com/panpf/sketch/issues/208>#208</a></li> <li>change: displayImage 重命名为 loadImage</li> <li>change: ImageView.disposeDisplay() 重命名为 ImageView.disposeLoad()</li> <li>new: ImageRequest.Builder 和 ImageOptions.Builder 新增 sizeWithView()、sizeWithDisplay() 扩展函数</li> </ul> <p>extensions:</p> <ul> <li>fix: 修复 AppIconUriFetcher.Factory 解析 versionCode 时异常的 bug。<a href=https://github.com/panpf/sketch/issues/204>#204</a></li> <li>change: 从 sketch-extensions-core 模块中拆分出 sketch-extensions-apkicon 和 sketch-extensions-appicon 模块</li> </ul> <p>other:</p> <ul> <li>upgrade：Android 最低 API 升到了 API 21</li> <li>depend: 升级 kotlin 2.0.21, kotlinx coroutines 1.9.0</li> <li>depend: 升级 jetbrains compose 1.7.0, jetbrains lifecycle 2.8.3</li> </ul> <h1 id=v400-rc01>v4.0.0-rc01<a class=headerlink href=#v400-rc01 title="Permanent link">&para;</a></h1> <p>compose:</p> <ul> <li>new: AsyncImageState 新增 onPainterState 和 onLoadState 属性，用于以回调的方式接收 PainterState 和 LoadState 更新</li> </ul> <h1 id=v400-beta03>v4.0.0-beta03<a class=headerlink href=#v400-beta03 title="Permanent link">&para;</a></h1> <p>core:</p> <ul> <li>new: 新增 Image.asBitmap(), asBitmapOrNull(), asDrawableOrNull(), asPainterOrNull() 扩展函数</li> <li>improve: ConditionStateImage 和 ComposableConditionStateImage 的 defaultImage 属性现在可空</li> </ul> <p>decode:</p> <ul> <li>improve: 改进根据 mimeType 判断是否支持区域解码，非 image 类型直接返回 false，非 Android 平台上根据 skiko 版本判断是否支持 heic、heif、avif 类型</li> </ul> <p>fetch:</p> <ul> <li>improve: AssetUriFetcher 和 ResourceUriFetcher 现在兼容 sketch3 的协议</li> </ul> <h1 id=400-beta02>4.0.0-beta02<a class=headerlink href=#400-beta02 title="Permanent link">&para;</a></h1> <p>core:</p> <ul> <li>fix: 修复磁盘缓存因被杀导致 REMOVE 记录丢失，重新初始化未校验文件是否存在导致 size() 异常的 bug <a href=https://github.com/panpf/sketch/issues/219>#219</a></li> </ul> <p>animated:</p> <ul> <li>fix: 修复 sketch-animated-heif 的依赖中意外的包含了本地测试 module 的 bug <a href=https://github.com/panpf/sketch/issues/220>#220</a></li> </ul> <h1 id=400-beta01>4.0.0-beta01<a class=headerlink href=#400-beta01 title="Permanent link">&para;</a></h1> <p>core:</p> <ul> <li>remove: 删除 Image.getPixels()</li> <li>remove: 移除 'com.github.panpf.sketch.annotation' 包下的 AnyThread、MainThread、IntRange、IntDef 注解，使用 'androidx.annotation' 包下的替代</li> <li>change: 合并 AndroidBitmapImage 和 SkiaBitmapImage 为 BitmapImage</li> <li>change: DrawableEqualizer 重命名为 EquitableDrawable</li> <li>change: 移除 AndroidBitmap、SkiBitmap、SkiaImageInfo、SkiaImage、SkiaRect</li> <li>change: SkiaAnimatedImage 重命名为 AnimatedImage</li> <li>change: ImageRequest 的 registerListener 和 registerProgressListener 方法重命名为 addListener 和 addProgressListener</li> <li>new: 新增 ComponentLoader，支持自动探测并注册 Fetcher 和 Decoder 组件，所有自带模块里的组件都已支持</li> </ul> <p>compose:</p> <ul> <li>fix: 修复 AsyncImage 的 filterQuality 参数无效的 bug。 <a href=https://github.com/panpf/sketch/issues/211>#211</a></li> <li>remove: 移除 ComposeBitmapImage</li> <li>change: 移除 PainterState.Empty</li> <li>change: PainterEqualizer 重命名为 EquitablePainter</li> <li>change: ComposeImagePainter 重命名为 ImageBitmapPainter、SkiaAnimatedImagePainter 重命名为 AnimatedImagePainter</li> </ul> <p>view:</p> <ul> <li>fix: 修复当 ImageView 已附到窗口但是因 padding 导致 size 为 null 时无法加载图片的 bug。 <a href=https://github.com/panpf/sketch/issues/208>#208</a></li> </ul> <p>decode:</p> <ul> <li>change: Decoder 的 decode() 方法移除 suspend 修饰符并且返回类型从 Result<decoderesult> 改为 DecodeResult</li> <li>change: BitmapConfig 重构为 BitmapColorType</li> <li>new: 非安卓平台现在也支持 ColorType 了</li> <li>new: 非安卓平台现在也支持 ColorSpace 了</li> <li>new: DrawableDecoder 支持 colorSpace</li> </ul> <p>fetch:</p> <ul> <li>change: Fetcher.Factory.create() 的传参改为 RequestContext</li> </ul> <p>cache:</p> <ul> <li>change: 现在非安卓平台上内存缓存中缓存的是 SkiaBitmapImage，不再是 ComposeBitmapImage</li> <li>change: 桌面和 web 平台的默认内存缓存大小现在是 256MB，ios 平台是 128MB</li> </ul> <p>http:</p> <ul> <li>remove: 移除 ImageRequest.Builder 和 ImageOptions.Builder 的 setHttpHeader() 和 addHttpHeader() 方法</li> <li>change: 移除 sketch-http-core 模块，增加 sketch-http-hurl 模块，sketch-http-ktor 模块重命名为 sketch-http-ktor2 并且不再支持 wasmJs，增加 sketch-http-ktor3 模块</li> </ul> <p>animated:</p> <ul> <li>fix: 修复非安卓平台上动图设置 repeatCount 并播放结束后没有停留在最后一帧，而停留在第一帧的 bug。 <a href=https://github.com/panpf/sketch/issues/212>#212</a></li> <li>fix: 修复 GifDrawable 和 MovieDrawable 无法正确应用 animatedTransformation 的 bug。 <a href=https://github.com/panpf/sketch/issues/214>#214</a></li> <li>fix: 修复 GifDrawableDecoder 的 repeatCount 设置错误应该加 1 的 bug。 <a href=https://github.com/panpf/sketch/issues/215>#215</a></li> <li>change: 拆分 sketch-animated 模块为 sketch-animated-core 和 sketch-animated-gif、sketch-animated-webp、sketch-animated-heif, sketch-animated-koralgif 模块重命名为 sketch-animated-gif-koral</li> <li>improve: animatedTransformation 现在支持非 Android 平台</li> </ul> <p>transformation:</p> <ul> <li>fix: 修复 CircleCrop、Rotate、RoundedCorners Transformation 在 RGB_565 时不工作的 bug。 <a href=https://github.com/panpf/sketch/issues/209>#209</a></li> <li>fix: 修复 Android 平台上 blur、rotate 等 Transformation 没有保持 ColorSpace 不变的 bug。 <a href=https://github.com/panpf/sketch/issues/213>#213</a></li> <li>change: Transformation 的 transform() 方法移除 suspend 修饰符</li> </ul> <p>state:</p> <ul> <li>change: ImageRequest 和 ImageOptions 的 error 属性的类型从 ErrorStateImage 改为 StateImage</li> <li>change: ErrorStateImage 重构为 ConditionStateImage，并且 ConditionStateImage 可以用在 placeholder 和 fallback</li> <li>improve: 改进 IconDrawable，支持有固定大小的 background 并且限制 icon 必须有固定尺寸或指定 iconSize</li> <li>improve: 改进 IconPainter，支持有固定大小的 background 并且限制 icon 必须有固定尺寸或指定 iconSize</li> <li>new: 新增 'Drawable.asStateImage(Any)' 和 'ColorDrawable.asStateImage()' 扩展函数</li> </ul> <p>extensions:</p> <ul> <li>fix: 修复 RingProgressDrawable, SectorProgressDrawable, RingProgressPainter, SectorProgressPainter 的 equals 方法未按预期执行的 bug。 <a href=https://github.com/panpf/sketch/issues/210>#210</a></li> <li>change: 从 sketch-extensions-core 模块中拆分出 sketch-extensions-apkicon 和 sketch-extensions-appicon 模块</li> </ul> <p>other:</p> <ul> <li>depend: 升级 kotlin 2.0.21, kotlinx coroutines 1.9.0</li> <li>depend: 升级 jetbrains compose 1.7.0, jetbrains lifecycle 2.8.3</li> </ul> <h1 id=400-alpha08>4.0.0-alpha08<a class=headerlink href=#400-alpha08 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 ComposableImageRequest() 和 ComposableImageOptions() 函数内部无法监听并更新 Compose State 的 bug。 <a href=https://github.com/panpf/sketch/issues/207>#207</a></li> <li>remove: 移除 SkiaExifOrientationHelper</li> <li>remove: DataSource 移除 sketch 和 request 属性</li> <li>change: DataSource 的 getFile() 和 getFileOrNull() 方法增加 Sketch 参数</li> <li>change: DataSource 的 openSourceOrNull() 和 getFileOrNull() 方法现在以扩展函数的形式提供</li> <li>change: RequestContext 移到 'com.github.panpf.sketch.request' 包下</li> <li>new: SkiaBitmapImage 现在支持内存缓存</li> <li>new: DataSource 新增 key 属性</li> </ul> <h1 id=400-alpha07>4.0.0-alpha07<a class=headerlink href=#400-alpha07 title="Permanent link">&para;</a></h1> <ul> <li>improve: SkiaAnimatedImagePainter 现在解码和绘制不共享 Bitmap 了，以避免画面错乱。 <a href=https://github.com/panpf/sketch/issues/206>#206</a></li> <li>improve: SkiaAnimatedImagePainter 现在走到绘制时依然没有启动动画，则会自动加载第一帧</li> <li>new: SkiaAnimatedImagePainter 现在支持缓存解码耗时超过帧持续时间的帧以提高播放流畅度，但这会使用更多的内存，默认关闭，通过 ' cacheDecodeTimeoutFrame()' 函数开启</li> </ul> <h1 id=400-alpha06>4.0.0-alpha06<a class=headerlink href=#400-alpha06 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 SkiaAnimatedImagePainter 在遇到伪装的 gif 图片时崩溃的 bug。<a href=https://github.com/panpf/sketch/issues/205>#205</a></li> <li>improve: 改进动图相关 Decoder 在判断图片类型时的准确性，不再依赖 FetchResult 的 mimeType 属性，因为它可能不准确</li> </ul> <h1 id=400-alpha05>4.0.0-alpha05<a class=headerlink href=#400-alpha05 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 AppIconUriFetcher.Factory 解析 versionCode 时异常的 bug。<a href=https://github.com/panpf/sketch/issues/204>#204</a></li> <li>change: KotlinResourceUriFetcher 支持的 uri 从 'kotlin.resource://' 改为 'file: ///kotlin_resource/'</li> <li>change: ComposeResourceUriFetcher 支持的 uri 从 'compose.resource://' 改为 'file:///compose_resource/'</li> <li>change: ResourceUriFetcher 支持的 uri 从 'android.resource: //resource?resType=drawable&amp;resName=ic_launcher' 和 'android.resource://resource?resId=1031232' 改为 'android.resource:///drawable/ic_launcher' 和 'android.resource:///1031232'</li> <li>change: ImageRequest.uri 属性的类型从 String 改为 Uri</li> <li>change: AssetUriFetcher 支持的 uri 从 'asset://' 改为 'file:///android_asset/'</li> <li>improve: Fetcher 的所有实现类都实现了 equals 和 hashCode 方法</li> </ul> <h1 id=400-alpha04>4.0.0-alpha04<a class=headerlink href=#400-alpha04 title="Permanent link">&para;</a></h1> <ul> <li>fix: 修复 HurlStack 和 OkHttpStack 因再次切换线程导致网络并发控制失败的问题 <a href=https://github.com/panpf/sketch/issues/199>#199</a></li> <li>fix: 修复所有网络任务完成后才会开始解码图片的 bug. <a href=https://github.com/panpf/sketch/issues/201>#201</a></li> <li>change: ImageOptions 和 ImageRequest 的 mergeComponents() 方法重命名为 addComponents()</li> <li>change: ImageView.loadImage() 和 newResourceUri() 函数的 drawableResId 参数重命名为 resId</li> <li>change: AndroidLogPipeline 和 PrintLogPipeline 改为单例模式</li> <li>improve: 检查 PlatformContext 的类型以防止将 Activity 传递给 Sketch 或 ImageRequest</li> <li>new: 添加 PlatformContext.sketch 和 View.sketch 扩展函数</li> <li>new: Sketch.Builder 和 ComponentRegistry.Builder 新增 addComponents() 函数</li> <li>new: Sketch.Builder 增加 networkParallelismLimited() 和 decodeParallelismLimited() 方法控制网络和解码并发数量 <a href=https://github.com/panpf/sketch/issues/200>#200</a></li> </ul> <h1 id=400-alpha03>4.0.0-alpha03<a class=headerlink href=#400-alpha03 title="Permanent link">&para;</a></h1> <ul> <li>change: ComposeBitmapValue 重命名为 ComposeBitmapImageValue</li> <li>change: 重构 Sketch.enqueueDownload() 和 executeDownload() 并从 sketch-extensions-core 模块移到 sketch-core 模块</li> <li>change: LongImageClipPrecisionDecider 重命名为 LongImagePrecisionDecider, LongImageStartCropScaleDecider 重命名为 LongImageScaleDecider</li> <li>change: 恢复在构建 ImageRequest 时使用屏幕大小作为最终的 Size</li> <li>improve: Painter.asSketchImage() 现在返回 PainterImage; ComposeBitmap.asSketchImage() 现在返回 ComposeBitmapImage</li> <li>new: ImageRequest.Builder 和 ImageOptions.Builder 新增 sizeWithView()、sizeWithDisplay()、size( IntSize) 扩展函数</li> </ul> <h1 id=400-alpha02>4.0.0-alpha02<a class=headerlink href=#400-alpha02 title="Permanent link">&para;</a></h1> <ul> <li>change: ImageView.disposeDisplay() 重命名为 ImageView.disposeLoad()</li> <li>new: 新增 ImageRequest.Builder.composableError() 和 ImageOptions.Builder.composableError() 扩展函数</li> <li>new: 新增 ErrorStateImage.Builder.saveCellularTrafficError(DrawableResource) 扩展函数</li> </ul> <h1 id=400-alpha01>4.0.0-alpha01<a class=headerlink href=#400-alpha01 title="Permanent link">&para;</a></h1> <p>Sketch:</p> <ul> <li>change: SketchSingleton 重构为 SingletonSketch</li> </ul> <p>request:</p> <ul> <li>change: 不再区分 Display、Load、Download，现在只有一个 ImageRequest、ImageResult、ImageListener</li> <li>change: ImageResult 的 requestKey 属性被移除、requestCacheKey 属性重命名为 cacheKey</li> <li>change: 现在 Target、ImageResult、DecodeResult 都使用 Image</li> <li>change: SketchDrawable 的 imageUri、requestKey、requestCacheKey、imageInfo、dataFrom、transformedList、extras 等属性被移除，现在请从 ImageResult 中获取它们</li> <li>change: depth 和 depthFrom 属性合并成 DepthHolder</li> <li>change: bitmapConfig、colorSpace、preferQualityOverSpeed、placeholder(Int)、fallback(Int)、error(Int) 等 Android 平台特有 API 以扩展函数的形式提供</li> <li>change: resizeApplyToDrawable 重命名为 resizeOnDraw</li> <li>change: Parameters 重命名为 Extras</li> <li>new: 新增 'sizeMultiplier: Float' 属性，用于设置图片大小的缩放比例</li> <li>new: 新增 'allowNullImage: Boolean' 属性</li> </ul> <p>decode:</p> <ul> <li>change: BitmapDecoder 和 DrawableDecoder 合并为 Decoder</li> <li>change: BitmapDecodeInterceptor 和 DrawableDecodeInterceptor 合并为 DecodeInterceptor</li> </ul> <p>cache:</p> <ul> <li>remove: 移除 BitmapPool 以及和它相关的 disallowReuseBitmap 属性、CountBitmap、SketchCountBitmapDrawable 类</li> <li>change: 重构 DiskCache SnapShot 和 Editor，get() 和 edit() 改为 openSnapShot() 和 openEditor() ，并且同一个 key 的 openSnapShot() 和 openEditor() 现在是互相冲突的, openSnapshot 未关闭前 openEditor 始终返回 null</li> <li>change: 重构 MemoryCache.Value</li> </ul> <p>state:</p> <ul> <li>change: ImageRequest 和 ImageOptions 的 uriEmpty 属性重命名为 fallback</li> <li>remove: 移除 ErrorStateImage.Builder.uriEmptyError()</li> </ul> <p>compose:</p> <ul> <li>remove: AsyncImage 可组合函数移除 placeholder、error、uriEmpty、onLoading、onSuccess、onError 参数</li> <li>upgrade：Compose Multiplatform 升级到 1.6.10</li> <li>new: AsyncImageState 现在可以设置 ImageOptions 了，例如：'rememberAsyncImageState { ImageOptions() }'</li> </ul> <p>view:</p> <ul> <li>change: displayImage 重命名为 loadImage</li> </ul> <p>other:</p> <ul> <li>upgrade：Android 最低 API 升到了 API 21</li> <li>upgrade：kotlin 升级到 2.0.0，主要是为了支持 Compose Multiplatform 1.6.10</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../migrate/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Migrate"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Migrate </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 panpf </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/panpf/sketch target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs", "content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.footer", "navigation.instant", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.50899def.min.js></script> </body> </html>