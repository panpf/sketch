<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An image loading library designed for Compose Multiplatform and Android View. It is powerful and rich in functions. In addition to basic functions, it also supports GIF, SVG, video thumbnails, Exif Orientation, etc."><meta name=author content="2024 panpf"><link href=https://github.com/panpf/sketch/zh/state_image/ rel=canonical><link href=../transition/ rel=prev><link href=../thumbnail/ rel=next><link rel=alternate href=../../state_image/ hreflang=en><link rel=alternate href=./ hreflang=zh><link rel=icon href=../../images/logo.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>StateImage - Sketch Image Loader</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"JetBrains";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#stateimage class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../ title="Sketch Image Loader" class="md-header__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sketch Image Loader </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> StateImage </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=white aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=black aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=../../state_image/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=./ hreflang=zh class=md-select__link> 中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../ title="Sketch Image Loader" class="md-nav__button md-logo" aria-label="Sketch Image Loader" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> Sketch Image Loader </label> <div class=md-nav__source> <a href=https://github.com/panpf/sketch title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Sketch </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../getting_started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../register_component/ class=md-nav__link> <span class=md-ellipsis> Register Component </span> </a> </li> <li class=md-nav__item> <a href=../compose/ class=md-nav__link> <span class=md-ellipsis> Compose </span> </a> </li> <li class=md-nav__item> <a href=../http/ class=md-nav__link> <span class=md-ellipsis> Http </span> </a> </li> <li class=md-nav__item> <a href=../animated_image/ class=md-nav__link> <span class=md-ellipsis> Animated Image </span> </a> </li> <li class=md-nav__item> <a href=../resize/ class=md-nav__link> <span class=md-ellipsis> Resize </span> </a> </li> <li class=md-nav__item> <a href=../transformation/ class=md-nav__link> <span class=md-ellipsis> Transformation </span> </a> </li> <li class=md-nav__item> <a href=../transition/ class=md-nav__link> <span class=md-ellipsis> Transition </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> StateImage </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> StateImage </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> <nav class=md-nav aria-label=配置> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 自定义 </span> </a> </li> <li class=md-nav__item> <a href=#conditionstateimage class=md-nav__link> <span class=md-ellipsis> ConditionStateImage </span> </a> </li> <li class=md-nav__item> <a href=#iconstateimage class=md-nav__link> <span class=md-ellipsis> Icon*StateImage </span> </a> </li> <li class=md-nav__item> <a href=#thumbnailmemorycachestateimage class=md-nav__link> <span class=md-ellipsis> ThumbnailMemoryCacheStateImage </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../thumbnail/ class=md-nav__link> <span class=md-ellipsis> Thumbnail </span> </a> </li> <li class=md-nav__item> <a href=../listener/ class=md-nav__link> <span class=md-ellipsis> Listener </span> </a> </li> <li class=md-nav__item> <a href=../download_cache/ class=md-nav__link> <span class=md-ellipsis> DownloadCache </span> </a> </li> <li class=md-nav__item> <a href=../result_cache/ class=md-nav__link> <span class=md-ellipsis> ResultCache </span> </a> </li> <li class=md-nav__item> <a href=../memory_cache/ class=md-nav__link> <span class=md-ellipsis> MemoryCache </span> </a> </li> <li class=md-nav__item> <a href=../fetcher/ class=md-nav__link> <span class=md-ellipsis> Fetcher </span> </a> </li> <li class=md-nav__item> <a href=../decoder/ class=md-nav__link> <span class=md-ellipsis> Decoder </span> </a> </li> <li class=md-nav__item> <a href=../target/ class=md-nav__link> <span class=md-ellipsis> Target </span> </a> </li> <li class=md-nav__item> <a href=../svg/ class=md-nav__link> <span class=md-ellipsis> SVG </span> </a> </li> <li class=md-nav__item> <a href=../video_frame/ class=md-nav__link> <span class=md-ellipsis> Video Frames </span> </a> </li> <li class=md-nav__item> <a href=../blurhash/ class=md-nav__link> <span class=md-ellipsis> BlurHash </span> </a> </li> <li class=md-nav__item> <a href=../exif_orientation/ class=md-nav__link> <span class=md-ellipsis> Exif Orientation </span> </a> </li> <li class=md-nav__item> <a href=../image_options/ class=md-nav__link> <span class=md-ellipsis> ImageOptions </span> </a> </li> <li class=md-nav__item> <a href=../interceptor/ class=md-nav__link> <span class=md-ellipsis> Interceptor </span> </a> </li> <li class=md-nav__item> <a href=../preload/ class=md-nav__link> <span class=md-ellipsis> Preload </span> </a> </li> <li class=md-nav__item> <a href=../download_image/ class=md-nav__link> <span class=md-ellipsis> Download Image </span> </a> </li> <li class=md-nav__item> <a href=../lifecycle/ class=md-nav__link> <span class=md-ellipsis> Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=../sketch_image_view/ class=md-nav__link> <span class=md-ellipsis> SketchImageView </span> </a> </li> <li class=md-nav__item> <a href=../long_image_grid_thumbnails/ class=md-nav__link> <span class=md-ellipsis> Clearer Thumbnail </span> </a> </li> <li class=md-nav__item> <a href=../progress_indicator/ class=md-nav__link> <span class=md-ellipsis> Progress Indicator </span> </a> </li> <li class=md-nav__item> <a href=../mime_type_logo/ class=md-nav__link> <span class=md-ellipsis> Mime Type Logo </span> </a> </li> <li class=md-nav__item> <a href=../save_cellular_traffic/ class=md-nav__link> <span class=md-ellipsis> Save Cellular Data </span> </a> </li> <li class=md-nav__item> <a href=../pause_load_when_scrolling/ class=md-nav__link> <span class=md-ellipsis> Pause Load When Scrolling </span> </a> </li> <li class=md-nav__item> <a href=../apk_app_icon/ class=md-nav__link> <span class=md-ellipsis> Apk/App Icon </span> </a> </li> <li class=md-nav__item> <a href=../log/ class=md-nav__link> <span class=md-ellipsis> Log </span> </a> </li> <li class=md-nav__item> <a href=../migrate/ class=md-nav__link> <span class=md-ellipsis> Migrate </span> </a> </li> <li class=md-nav__item> <a href=../CHANGELOG/ class=md-nav__link> <span class=md-ellipsis> Change Log </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> <nav class=md-nav aria-label=配置> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 自定义 </span> </a> </li> <li class=md-nav__item> <a href=#conditionstateimage class=md-nav__link> <span class=md-ellipsis> ConditionStateImage </span> </a> </li> <li class=md-nav__item> <a href=#iconstateimage class=md-nav__link> <span class=md-ellipsis> Icon*StateImage </span> </a> </li> <li class=md-nav__item> <a href=#thumbnailmemorycachestateimage class=md-nav__link> <span class=md-ellipsis> ThumbnailMemoryCacheStateImage </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=stateimage>StateImage<a class=headerlink href=#stateimage title="Permanent link">&para;</a></h1> <p>翻译：<a href=./ >English</a></p> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/StateImage.kt>StateImage</a> 用来为加载中状态和错误状态提供图片，有以下几种实现：</p> <p>View 专用:</p> <ul> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/state/DrawableStateImage.kt>DrawableStateImage</a>：使用 Drawable 作为状态图片</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/state/ColorDrawableStateImage.kt>ColorDrawableStateImage</a>：使用颜色创建 ColorDrawable 作为状态图片</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/state/IconDrawableStateImage.kt>IconDrawableStateImage</a>：使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/drawable/IconDrawable.kt>IconDrawable</a> 作为状态图片。可以确保图标大小始终不变，不受组件的缩放影响，适合用在瀑布流布局中</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/state/IconAnimatableDrawableStateImage.kt>IconAnimatableDrawableStateImage</a>：使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/androidMain/kotlin/com/github/panpf/sketch/drawable/IconAnimatableDrawable.kt>IconAnimatableDrawable</a> 作为状态图片。可以确保图标大小始终不变，不受组件的缩放影响，适合用在瀑布流布局中</li> </ul> <p>Compose 专用:</p> <ul> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/state/PainterStateImage.kt>PainterStateImage</a>：使用 Painter 作为状态图片</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ColorPainterStateImage.kt>ColorPainterStateImage</a>：使用颜色创建 ColorPainter 作为状态图片</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/state/IconPainterStateImage.common.kt>IconPainterStateImage</a>：使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/painter/IconPainter.common.kt>IconPainter</a> 作为状态图片。可以确保图标大小始终不变，不受组件的缩放影响，适合用在瀑布流布局中</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/state/IconAnimatablePainterStateImage.common.kt>IconAnimatablePainterStateImage</a>：使用 <a href=https://github.com/panpf/sketch/blob/main/sketch-compose-core/src/commonMain/kotlin/com/github/panpf/sketch/painter/IconAnimatablePainter.common.kt>IconAnimatablePainter</a> 作为状态图片。可以确保图标大小始终不变，不受组件的缩放影响，适合用在瀑布流布局中</li> </ul> <p>通用:</p> <ul> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/CurrentStateImage.kt>CurrentStateImage</a>：使用组件当前的 Image 作为状态图片</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/MemoryCacheStateImage.kt>MemoryCacheStateImage</a>：使用给定的内存缓存 key 从内存缓存中获取 Image 作为状态图片，搭配 crossfade 可以实现从小图到大图的完美过渡</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ThumbnailMemoryCacheStateImage.kt>ThumbnailMemoryCacheStateImage</a>：<a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/MemoryCacheStateImage.kt>MemoryCacheStateImage</a> 的简化版，使用给定的或当前请求的 uri 匹配内存缓存中的宽高比和原图一致，并且没有用 Transformation 修改的缩略图作为状态图片。同样搭配 crossfade 可以实现从小图到大图的完美过渡</li> <li><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ConditionStateImage.common.kt>ConditionStateImage</a>：可根据不同条件使用不同的状态图片</li> </ul> <h2 id=_1>配置<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/StateImage.kt>StateImage</a> 用在 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 和 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageOptions.common.kt>ImageOptions</a> 的 placeholder(), fallback(), error() 方法，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// View</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getEquitableDrawable</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>))</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>IntColorDrawableStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>Gray</span><span class=p>))</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>DrawableStateImage</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>))</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>IconDrawableStateImage</span><span class=p>(</span><span class=n>icon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IntColorFetcher</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>GRAY</span><span class=p>)))</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>ConditionStateImage</span><span class=p>(</span><span class=n>defaultResId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>){</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>resId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>)</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getEquitableDrawable</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>))</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>IntColorDrawableStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>RED</span><span class=p>))</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>DrawableStateImage</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>))</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>IconDrawableStateImage</span><span class=p>(</span><span class=n>icon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IntColorFetcher</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>RED</span><span class=p>)))</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>ConditionStateImage</span><span class=p>(</span><span class=n>defaultResId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>resId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getEquitableDrawable</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>))</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>IntColorDrawableStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>RED</span><span class=p>))</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>DrawableStateImage</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>))</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>IconDrawableStateImage</span><span class=p>(</span><span class=n>icon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IntColorFetcher</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>RED</span><span class=p>)))</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>ConditionStateImage</span><span class=p>(</span><span class=n>defaultResId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>resId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=p>}</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=c1>// Compose</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=n>ComposableImageRequest</span><span class=p>(</span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>)</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>rememberPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>))</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>rememberColorPainterStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>Gray</span><span class=p>))</span>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>rememberIconPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Color</span><span class=p>.</span><span class=na>Gray</span><span class=p>))</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>  </span><span class=n>placeholder</span><span class=p>(</span><span class=n>ComposableConditionStateImage</span><span class=p>(</span><span class=n>defaultImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>placeholder</span><span class=p>){</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>stateImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>)</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>rememberPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>))</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>rememberColorPainterStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>Red</span><span class=p>))</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>rememberIconPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Color</span><span class=p>.</span><span class=na>Red</span><span class=p>))</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=w>  </span><span class=n>fallback</span><span class=p>(</span><span class=n>ComposableConditionStateImage</span><span class=p>(</span><span class=n>defaultImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>fallback</span><span class=p>){</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>stateImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>rememberPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>))</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>rememberColorPainterStateImage</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=na>Red</span><span class=p>))</span>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>rememberIconPainterStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>,</span><span class=w> </span><span class=n>background</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Color</span><span class=p>.</span><span class=na>Red</span><span class=p>))</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>ComposableConditionStateImage</span><span class=p>(</span><span class=n>defaultImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>){</span>
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>stateImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>)</span>
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=p>}</span>
</code></pre></div> <blockquote> <p>[!TIP] 需要导入 <code>sketch-compose-resources</code> 模块 placeholder、fallback、error 才能支持 compose resources 的 DrawableResource</p> </blockquote> <h3 id=_2>自定义<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>可参考现有 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/StateImage.kt>StateImage</a> 的实现</p> <h3 id=conditionstateimage>ConditionStateImage<a class=headerlink href=#conditionstateimage title="Permanent link">&para;</a></h3> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ConditionStateImage.common.kt>ConditionStateImage</a> 支持根据不同的条件返回不同的状态图片，你可以实现 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ConditionStateImage.common.kt>ConditionStateImage</a> .Condition 接口来扩展新的类型，然后通过 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ConditionStateImage.common.kt>ConditionStateImage</a>.Builder.addState() 使用自定义的类型，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kd>object</span><span class=w> </span><span class=nc>MyCondition</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>ConditionStateImage</span><span class=p>.</span><span class=na>Condition</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>        </span><span class=n>request</span><span class=p>:</span><span class=w> </span><span class=n>ImageRequest</span><span class=p>,</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>        </span><span class=n>throwable</span><span class=p>:</span><span class=w> </span><span class=n>Throwable?</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=p>):</span><span class=w> </span><span class=kt>Boolean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>throwable</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>IOException</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=p>}</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1>// View</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>ConditionStateImage</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>stateImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DrawableStateImage</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>))</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=p>}</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=c1>// Compose</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=n>ComposableImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>  </span><span class=n>error</span><span class=p>(</span><span class=n>ComposableConditionStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=n>addState</span><span class=p>(</span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MyCondition</span><span class=p>,</span><span class=w> </span><span class=n>stateImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DrawableStateImage</span><span class=p>(</span><span class=n>Res</span><span class=p>.</span><span class=na>drawable</span><span class=p>.</span><span class=na>mystate</span><span class=p>))</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=p>})</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=p>}</span>
</code></pre></div> <h3 id=iconstateimage>Icon*StateImage<a class=headerlink href=#iconstateimage title="Permanent link">&para;</a></h3> <p>在瀑布流布局中由于每个 item 的大小可能不一样，所有 item 使用同一个 placeholder 时由于组件的缩放会导致在页面上看起来 placeholder 会有大有小</p> <p>针对这样的情况使用 Icon*StateImage 可以完美解决问题，Icon*StateImage 由一个图标和一个背景组成，图标不受组件缩放影响图标始终保持固定大小不变，这样页面上看起来所有 placeholder 都是一样的大小</p> <h3 id=thumbnailmemorycachestateimage>ThumbnailMemoryCacheStateImage<a class=headerlink href=#thumbnailmemorycachestateimage title="Permanent link">&para;</a></h3> <p>从图片列表页面跳到图片详情页时我们希望能用列表页面已加载的缩略图片作为详情页加载大图时的占位图</p> <p>这样在配合上 <code>crossfade(fadeStart = false)</code> 在大图加载完成时页面上看起来会从较模糊的图片逐渐变为一张清晰的图片，这样的效果会比较好</p> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ThumbnailMemoryCacheStateImage.kt>ThumbnailMemoryCacheStateImage</a> 就可以帮助我们非常方便的从内存缓存中寻找的缩略图，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=n>placeholder</span><span class=p>(</span><span class=n>ThumbnailMemoryCacheStateImage</span><span class=p>())</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=n>crossfade</span><span class=p>(</span><span class=n>fadeStart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=p>}</span>
</code></pre></div> <p><a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/state/ThumbnailMemoryCacheStateImage.kt>ThumbnailMemoryCacheStateImage</a> 默认会用当前 <a href=https://github.com/panpf/sketch/blob/main/sketch-core/src/commonMain/kotlin/com/github/panpf/sketch/request/ImageRequest.common.kt>ImageRequest</a> 的 uri 去内存中寻找缩略图，但如果列表页面和详情页面用的是不同的 uri 就需要主动指定列表页面的 uri，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>ImageRequest</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://example.com/image.jpg&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=n>placeholder</span><span class=p>(</span><span class=n>ThumbnailMemoryCacheStateImage</span><span class=p>(</span><span class=s>&quot;https://www.sample.com/image.jpg?widht=300&quot;</span><span class=p>))</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=n>crossfade</span><span class=p>(</span><span class=n>fadeStart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=p>}</span>
</code></pre></div> <blockquote> <p>[!TIP] 缩略图的标准为宽高比一致并且没有用任何 Transformation 修改的图片</p> </blockquote> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../transition/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Transition"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Transition </div> </div> </a> <a href=../thumbnail/ class="md-footer__link md-footer__link--next" aria-label="下一页: Thumbnail"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Thumbnail </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 panpf </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/panpf/sketch target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.tabs", "content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.footer", "navigation.instant", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>